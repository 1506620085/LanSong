# 我的音乐功能说明

## 功能概述

"我的音乐"是一个全新的功能模块，允许用户查看和管理自己网易云音乐账号中的歌单，并可以直接从个人歌单中点歌。

## 核心特性

### 1. ✅ 登录验证
- 必须先登录本机网易云账号才能访问
- 未登录时会提示并弹出登录对话框
- 登录后自动加载用户歌单

### 2. 📂 歌单管理
- **创建的歌单**：显示用户自己创建的所有歌单
- **收藏的歌单**：显示用户收藏的其他人的歌单
- 树状结构展示，支持折叠/展开
- 显示歌单封面、名称、歌曲数量

### 3. 🎵 歌曲浏览
- 左右分栏布局
  - 左侧：树状歌单列表
  - 右侧：选中歌单的歌曲详情
- 默认打开"我喜欢的音乐"（第一个创建的歌单）
- 完整的歌单信息展示（封面、描述、创建者、歌曲数等）

### 4. 🎤 点歌功能
- 单首点歌：点击"点歌"按钮添加
- 双击行快速点歌
- 批量点歌：播放全部/添加到播放列表
- 实时反馈添加状态

## 页面布局

```
┌──────────────────────────────────────────────────────┐
│  顶部导航栏：点歌 | 我的音乐 | 播放器               │
├────────────┬─────────────────────────────────────────┤
│            │  歌单头部                                │
│  我的歌单  │  ┌─────────────────────────────────┐    │
│            │  │  [封面]  歌单名称                │    │
│  创建的歌单│  │          创建者信息              │    │
│  ├ 我喜欢  │  │          [播放全部] [添加全部]   │    │
│  ├ 歌单2   │  └─────────────────────────────────┘    │
│  └ ...     │                                          │
│            │  歌曲列表                                │
│  收藏的歌单│  ┌─────────────────────────────────┐    │
│  ├ 歌单A   │  │  # │ 歌名 │ 歌手 │ 专辑 │ 时长│操作│
│  └ ...     │  │  1 │ xxx  │ xxx  │ xxx  │ xx │点歌│
│            │  │  2 │ xxx  │ xxx  │ xxx  │ xx │点歌│
│            │  └─────────────────────────────────┘    │
└────────────┴─────────────────────────────────────────┘
```

## 使用流程

### 1. 登录流程
```
点击"我的音乐" 
    ↓
检查是否已登录网易云
    ↓ (未登录)
弹出登录对话框
    ↓
扫码登录成功
    ↓
自动跳转到我的音乐页面
```

### 2. 浏览歌单
```
进入我的音乐页面
    ↓
自动加载用户歌单列表
    ↓
默认打开"我喜欢的音乐"
    ↓
显示歌单中的所有歌曲
```

### 3. 点歌操作
```
选择歌单 → 查看歌曲列表 → 点击"点歌"按钮
                          ↓
                     添加到播放队列
                          ↓
                     显示成功提示
```

## 技术实现

### 后端API

#### 1. 获取用户歌单
```
GET /api/my-music/playlists

Response:
{
  "success": true,
  "data": {
    "created": [
      {
        "id": 123456,
        "name": "我喜欢的音乐",
        "coverImgUrl": "...",
        "trackCount": 100,
        "playCount": 5000,
        "description": "...",
        "creator": {
          "userId": 12345,
          "nickname": "用户名"
        }
      }
    ],
    "subscribed": [...]
  }
}
```

#### 2. 获取歌单详情
```
GET /api/my-music/playlist/detail/:id

Response:
{
  "success": true,
  "data": {
    "id": 123456,
    "name": "我喜欢的音乐",
    "coverImgUrl": "...",
    "description": "...",
    "trackCount": 100,
    "playCount": 5000,
    "tracks": [
      {
        "id": 111,
        "name": "歌曲名",
        "artists": [{"id": 1, "name": "歌手"}],
        "album": {
          "id": 11,
          "name": "专辑",
          "picUrl": "..."
        },
        "duration": 240000
      }
    ]
  }
}
```

### 前端实现

#### 1. 路由配置
```javascript
{
  path: '/my-music',
  name: 'MyMusic',
  component: MyMusic,
  meta: { title: '我的音乐' }
}
```

#### 2. 主要组件
- **MyMusic.vue**：我的音乐主页面
- **LocalLoginDialog.vue**：本机用户登录对话框

#### 3. 状态管理
```javascript
// 歌单数据
const playlists = reactive({
  created: [],      // 创建的歌单
  subscribed: []    // 收藏的歌单
})

// 当前选中的歌单和歌曲
const currentPlaylist = ref(null)
const tracks = ref([])

// 折叠状态
const createdCollapsed = ref(false)
const subscribedCollapsed = ref(false)
```

## UI设计特点

### 1. 未登录状态
```
┌──────────────────────────────┐
│                              │
│       [用户图标]             │
│                              │
│   请先登录网易云音乐         │
│   登录后可以查看您的歌单     │
│                              │
│     [立即登录]               │
│                              │
└──────────────────────────────┘
```

### 2. 左侧歌单列表
- 固定宽度280px
- 白色背景，右侧边框分隔
- 分类header可点击折叠/展开
- 歌单项hover效果
- 选中状态蓝色高亮

### 3. 右侧歌曲详情
- 自适应宽度
- 歌单信息卡片式展示
- 表格形式展示歌曲列表
- 双击行快速点歌
- 操作按钮响应式反馈

## 功能亮点

### 1. 🔐 安全性
- 基于IP的独立Cookie管理
- 每个用户独立登录状态
- Cookie持久化存储

### 2. 🎯 用户体验
- 未登录自动提示
- 默认打开喜欢的音乐
- 双击快速点歌
- 批量操作支持

### 3. 🎨 界面设计
- 清晰的左右分栏布局
- 树状结构易于浏览
- 现代化卡片设计
- 流畅的交互动画

### 4. ⚡ 性能优化
- 懒加载歌单详情
- 组件级状态管理
- 智能缓存机制

## 使用示例

### 示例1：首次访问
1. 用户点击导航栏"我的音乐"
2. 系统检测到未登录
3. 弹出提示："请先登录网易云音乐"
4. 自动弹出登录对话框
5. 用户扫码登录
6. 自动跳转到我的音乐页面
7. 显示用户的所有歌单
8. 默认打开"我喜欢的音乐"

### 示例2：浏览和点歌
1. 用户已登录状态进入我的音乐
2. 左侧显示歌单列表
3. 点击"创建的歌单"下的某个歌单
4. 右侧显示该歌单的所有歌曲
5. 双击某首歌曲或点击"点歌"按钮
6. 歌曲添加到播放队列
7. 显示成功提示

### 示例3：批量添加
1. 选择一个歌单查看详情
2. 点击"播放全部"按钮
3. 系统自动添加前10首歌曲
4. 显示添加进度和结果

## API调用示例

### 前端调用
```javascript
import api from '@/utils/api'

// 获取歌单列表
const playlists = await api.getMyPlaylists()

// 获取歌单详情
const detail = await api.getPlaylistDetail(playlistId)

// 添加歌曲到队列
await api.addToQueue(songData)
```

### 错误处理
```javascript
try {
  const result = await api.getMyPlaylists()
  if (result.success) {
    // 处理成功
  } else {
    ElMessage.error(result.error)
  }
} catch (error) {
  ElMessage.error('网络错误')
}
```

## 注意事项

### 1. 登录要求
- 必须使用本机网易云登录功能
- 不能使用主机全局登录
- Cookie独立存储，互不干扰

### 2. 歌单限制
- 只显示用户自己的歌单
- 收藏的歌单需要有访问权限
- 部分VIP歌曲可能无法播放

### 3. 批量操作
- 一次最多添加10首歌曲
- 避免队列过长影响体验
- 超过10首会有提示

### 4. 性能考虑
- 歌单列表按需加载
- 歌曲详情懒加载
- 避免频繁请求API

## 常见问题

### Q1: 为什么我看不到"我的音乐"？
A: 请确保：
1. 已登录本机网易云账号
2. 网易云账号有歌单数据
3. 网络连接正常

### Q2: 歌单为什么是空的？
A: 可能原因：
1. 该歌单确实没有歌曲
2. 网络延迟导致加载失败
3. 权限问题（收藏的私密歌单）

### Q3: 点歌失败怎么办？
A: 检查以下几点：
1. 是否有播放权限（VIP歌曲）
2. 网络连接是否正常
3. 歌曲URL是否有效
4. 队列是否已满

### Q4: 如何刷新歌单？
A: 点击歌单列表顶部的刷新按钮

## 未来规划

### 短期优化
- [ ] 歌曲搜索和过滤
- [ ] 歌单内歌曲排序
- [ ] 喜欢歌曲同步
- [ ] 播放历史记录

### 中期扩展
- [ ] 创建新歌单
- [ ] 编辑歌单信息
- [ ] 歌曲移动和删除
- [ ] 歌单分享功能

### 长期愿景
- [ ] 智能推荐
- [ ] 歌单协同编辑
- [ ] 评论和互动
- [ ] 数据分析和统计

## 技术栈

### 后端
- Node.js + Express
- NeteaseCloudMusicApi
- 客户端Cookie管理

### 前端
- Vue 3 Composition API
- Vue Router
- Element Plus
- Axios

## 更新日志

### v1.3.0 (2025-11-19)
- ✨ 新增"我的音乐"功能模块
- 🎵 支持查看创建的歌单和收藏的歌单
- 🎤 支持从个人歌单中点歌
- 🔐 集成本机网易云登录验证
- 🎨 现代化的左右分栏布局设计
- ⚡ 默认打开"我喜欢的音乐"
- 🎯 支持单首点歌和批量添加
- 📱 响应式设计，适配各种屏幕

## 相关文档

- [客户端登录功能说明](CLIENT_LOGIN_FEATURE.md)
- [登录对话框样式同步](LOGIN_DIALOGS_SYNC.md)
- [项目结构说明](PROJECT_STRUCTURE.md)
