# 局域网点歌系统 - 使用指南

## 快速开始

### 1. 安装依赖

双击运行 `install.bat`，或手动执行：

```bash
# 安装后端依赖
cd server
npm install

# 安装前端依赖
cd ../client
npm install
```

### 2. 配置登录方式

编辑 `server/config.json` 文件：

```json
{
  "loginMethod": "qrcode",
  "port": 3000
}
```

**登录方式**：

#### 方式一：二维码登录（推荐）

```json
{
  "loginMethod": "qrcode",
  "port": 3000
}
```

启动服务时会在控制台显示二维码，使用网易云音乐 APP 扫码登录即可。

**优点**：
- ✅ 安全，不需要保存密码
- ✅ 不容易触发风控
- ✅ 使用体验更好
- ✅ 支持所有账号类型

#### 方式二：手机号密码登录（不推荐）

```json
{
  "loginMethod": "password",
  "phone": "你的手机号",
  "password": "你的密码",
  "port": 3000
}
```

**缺点**：
- ⚠️ 需要保存密码在配置文件
- ⚠️ 容易触发网易云风控
- ⚠️ 可能需要验证码

⚠️ **注意**：
- 需要一个有效的网易云音乐账号
- 部分 VIP 歌曲需要 VIP 账号才能播放
- 建议使用二维码登录方式

### 3. 启动服务

#### 开发模式（推荐用于调试）

双击 `start-dev.bat`，或手动执行：

```bash
# 终端1：启动后端
cd server
node app.js

# 终端2：启动前端开发服务
cd client
npm run dev
```

开发模式特点：
- 前端热重载，修改代码立即生效
- 前端访问 http://localhost:5173
- API 请求自动代理到后端

#### 生产模式（推荐用于实际使用）

```bash
# 1. 构建前端
双击 build.bat 或执行: cd client && npm run build

# 2. 启动服务
双击 start-prod.bat 或执行: cd server && node app.js
```

生产模式特点：
- 前端代码经过压缩优化
- 只需启动一个后端服务
- 直接访问 http://localhost:3000

### 4. 访问应用

服务启动后，控制台会显示访问地址：

```
📍 本地访问地址: http://localhost:3000

📱 局域网访问地址:
   http://192.168.1.100:3000

🎮 使用说明:
   - 点歌页面: http://localhost:3000/
   - 主控播放器: http://localhost:3000/player
```

## 使用场景

### 场景1：办公室/家庭聚会

1. **准备工作**
   - 一台电脑作为主控设备（连接音响）
   - 确保所有设备在同一局域网内
   - 启动服务（生产模式）

2. **主控设备**
   - 访问 `http://[服务器IP]:3000/player`
   - 连接音响设备
   - 保持页面打开，音乐会自动播放

3. **其他设备**
   - 手机/电脑访问 `http://[服务器IP]:3000/`
   - 搜索喜欢的歌曲
   - 点击"点歌"按钮添加到队列

### 场景2：聚会游戏（猜歌名）

1. 主持人在主控页面控制播放
2. 参与者可以实时看到播放队列
3. 可以提前点好歌曲，主持人控制播放时机

## 功能说明

### 点歌页面功能

- **搜索歌曲**：输入歌曲名或歌手名搜索
- **查看正在播放**：显示当前播放的歌曲
- **查看播放队列**：实时显示等待播放的歌曲
- **点歌**：点击"点歌"按钮将歌曲添加到队列
- **实时同步**：队列变化会自动更新到所有设备

### 主控播放器功能

- **自动播放**：队列有歌曲时自动开始播放
- **播放控制**：播放/暂停、上一首、下一首
- **进度控制**：拖动进度条跳转播放位置
- **音量调节**：调节播放音量
- **队列管理**：查看队列、删除歌曲、清空队列
- **自动切歌**：歌曲播放完成自动播放下一首

## 常见问题

### Q1: 登录失败怎么办？

**A:** 根据登录方式检查：

**二维码登录（推荐）**：
- 确保网络连接正常
- 使用最新版网易云音乐 APP
- 在 2 分钟内完成扫码
- 确认在手机上点击了"登录"按钮
- 如果二维码过期，重启服务器重新生成

**手机号密码登录（不推荐）**：
- config.json 中的账号密码是否正确
- 是否触发了风控（建议改用二维码登录）
- 是否需要手机验证码
- 可以尝试先在网易云官网登录一次

### Q2: 搜索不到歌曲？

**A:** 可能的原因：
- 关键词输入有误，尝试换个关键词
- 网络问题，检查网络连接
- API 限制，等待一段时间后再试
- 某些歌曲可能没有版权

### Q3: 歌曲无法播放？

**A:** 可能的原因：
- VIP 歌曲需要 VIP 账号
- 部分歌曲没有播放权限
- 播放链接已过期（系统会自动跳到下一首）
- 网络问题导致加载失败

### Q4: 局域网内其他设备无法访问？

**A:** 检查以下几点：
- 确保所有设备在同一局域网内
- 检查服务器防火墙设置，确保 3000 端口开放
- 尝试关闭服务器的防火墙测试
- 使用控制台显示的局域网 IP 地址访问

### Q5: 播放器页面没有声音？

**A:** 请检查：
- 浏览器音量是否静音
- 系统音量是否开启
- 音响设备是否正确连接
- 页面上的音量滑块是否为 0

### Q6: 如何修改端口号？

**A:** 编辑 `server/config.json` 文件，修改 `port` 字段：

```json
{
  "phone": "你的手机号",
  "password": "你的密码",
  "port": 8080
}
```

## 技术支持

### 查看日志

后端控制台会显示详细的运行日志：
- 登录状态
- API 请求
- WebSocket 连接
- 队列操作

### 性能优化建议

1. **使用有线网络**：主控设备建议使用有线连接，更稳定
2. **关闭不必要的应用**：释放系统资源
3. **使用现代浏览器**：Chrome、Edge、Firefox 等
4. **定期清理队列**：避免队列过长

### 安全建议

1. **仅在信任的局域网内使用**
2. **不要将服务暴露到公网**
3. **使用专门的公共账号**，不要使用个人账号
4. **定期更换账号密码**

## 进阶使用

### 自定义端口

修改 `server/config.json` 中的 `port` 字段。

### 在路由器上配置

如果需要跨网段访问，可以在路由器上配置端口转发。

### 开机自启动

Windows：
1. 创建 `start-prod.bat` 的快捷方式
2. 将快捷方式放到启动文件夹
   - 按 `Win+R` 输入 `shell:startup`

### 使用 Docker 部署

可以考虑使用 Docker 容器化部署，提高稳定性和可移植性。

## 更新日志

### v1.0.0 (2025-11-06)

- ✨ 初始版本发布
- 🎵 支持搜索网易云音乐
- 🎮 中心化播放模式
- 📱 响应式设计
- 🔄 实时队列同步
- 🎨 美观的用户界面

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License

